version: '3.8'

services:
  autoarr:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: autoarr
    restart: unless-stopped
    ports:
      - "8088:8088"
    volumes:
      - ./data:/data
      - ./logs:/app/logs
    environment:
      # Application Settings
      APP_ENV: ${APP_ENV:-development}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      PORT: 8088

      # Security (REQUIRED in production)
      SECRET_KEY: ${SECRET_KEY}

      # Database (SQLite by default)
      DATABASE_URL: ${DATABASE_URL:-sqlite:////data/autoarr.db}

      # Redis Cache (optional, in-memory by default)
      REDIS_URL: ${REDIS_URL:-memory://}

      # SABnzbd Configuration
      SABNZBD_ENABLED: ${SABNZBD_ENABLED:-true}
      SABNZBD_URL: ${SABNZBD_URL}
      SABNZBD_API_KEY: ${SABNZBD_API_KEY}
      SABNZBD_TIMEOUT: ${SABNZBD_TIMEOUT:-30}

      # Sonarr Configuration
      SONARR_ENABLED: ${SONARR_ENABLED:-true}
      SONARR_URL: ${SONARR_URL}
      SONARR_API_KEY: ${SONARR_API_KEY}
      SONARR_TIMEOUT: ${SONARR_TIMEOUT:-30}

      # Radarr Configuration
      RADARR_ENABLED: ${RADARR_ENABLED:-true}
      RADARR_URL: ${RADARR_URL}
      RADARR_API_KEY: ${RADARR_API_KEY}
      RADARR_TIMEOUT: ${RADARR_TIMEOUT:-30}

      # Plex Configuration (optional)
      PLEX_ENABLED: ${PLEX_ENABLED:-false}
      PLEX_URL: ${PLEX_URL:-}
      PLEX_TOKEN: ${PLEX_TOKEN:-}
      PLEX_TIMEOUT: ${PLEX_TIMEOUT:-30}

      # AI Features (optional - for LLM-powered configuration audits)
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      BRAVE_API_KEY: ${BRAVE_API_KEY:-}

      # CORS Settings (adjust for your frontend URL)
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:3000,http://localhost:5173}

    # Resource limits (adjust based on your system)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8088/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# Optional: Connect to existing media stack network
# Uncomment if your SABnzbd/Sonarr/Radarr/Plex are on a specific network
# networks:
#   default:
#     external: true
#     name: your_media_network_name
