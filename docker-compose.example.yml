version: '3.8'

services:
  autoarr:
    image: ghcr.io/yourusername/autoarr:latest
    container_name: autoarr
    restart: unless-stopped
    ports:
      - "8088:8088"
    volumes:
      - ./data:/data
      - ./logs:/app/logs
    environment:
      # Application
      APP_ENV: production
      LOG_LEVEL: INFO
      PORT: 8088

      # Database (SQLite by default)
      DATABASE_URL: sqlite:////data/autoarr.db

      # Redis (in-memory by default)
      REDIS_URL: memory://

      # SABnzbd Configuration
      SABNZBD_ENABLED: "true"
      SABNZBD_URL: http://sabnzbd:8080
      SABNZBD_API_KEY: ${SABNZBD_API_KEY}
      SABNZBD_TIMEOUT: 30

      # Sonarr Configuration
      SONARR_ENABLED: "true"
      SONARR_URL: http://sonarr:8989
      SONARR_API_KEY: ${SONARR_API_KEY}
      SONARR_TIMEOUT: 30

      # Radarr Configuration
      RADARR_ENABLED: "true"
      RADARR_URL: http://radarr:7878
      RADARR_API_KEY: ${RADARR_API_KEY}
      RADARR_TIMEOUT: 30

      # Plex Configuration
      PLEX_ENABLED: "true"
      PLEX_URL: http://plex:32400
      PLEX_TOKEN: ${PLEX_TOKEN}
      PLEX_TIMEOUT: 30

      # AI Features (Optional)
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      BRAVE_API_KEY: ${BRAVE_API_KEY:-}

    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8088/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# Optional: Connect to existing media stack network
# Uncomment and adjust network name as needed
# networks:
#   media-stack:
#     external: true
#     name: your_media_network_name
