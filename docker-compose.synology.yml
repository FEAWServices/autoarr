# Synology Docker Compose Configuration for AutoArr
# This configuration is optimized for Synology NAS deployment
#
# Prerequisites:
# 1. Install Container Manager from Synology Package Center
# 2. Create the following folders in File Station:
#    - /docker/autoarr/data (for database and config)
#    - /docker/autoarr/logs (for application logs)
# 3. Ensure your existing *arr apps are accessible on the network
#
# Environment Variables Setup:
# Copy the .env.synology.example to .env and configure:
# - API keys for SABnzbd, Sonarr, Radarr, Plex
# - Anthropic API key (optional, for AI features)
# - Service URLs (if not using defaults)

version: '3.8'

services:
  autoarr:
    image: ghcr.io/yourusername/autoarr:latest
    container_name: autoarr
    hostname: autoarr
    restart: unless-stopped

    # Environment configuration
    environment:
      # Application settings
      - APP_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - TZ=${TZ:-America/New_York}

      # Database (using SQLite for simplicity on Synology)
      - DATABASE_URL=sqlite:////data/autoarr.db
      - REDIS_URL=memory://

      # SABnzbd connection (REQUIRED)
      - SABNZBD_URL=${SABNZBD_URL:-http://sabnzbd:8080}
      - SABNZBD_API_KEY=${SABNZBD_API_KEY}

      # Sonarr connection (REQUIRED)
      - SONARR_URL=${SONARR_URL:-http://sonarr:8989}
      - SONARR_API_KEY=${SONARR_API_KEY}

      # Radarr connection (REQUIRED)
      - RADARR_URL=${RADARR_URL:-http://radarr:7878}
      - RADARR_API_KEY=${RADARR_API_KEY}

      # Plex connection (REQUIRED)
      - PLEX_URL=${PLEX_URL:-http://plex:32400}
      - PLEX_TOKEN=${PLEX_TOKEN}

      # LLM Configuration (OPTIONAL - for AI features)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

      # Web Search Configuration (OPTIONAL)
      - BRAVE_API_KEY=${BRAVE_API_KEY}

    # Volume mappings - adjust paths for your Synology setup
    volumes:
      # Persistent data storage
      - /volume1/docker/autoarr/data:/data

      # Application logs
      - /volume1/docker/autoarr/logs:/app/logs

    # Port mapping
    ports:
      - "${AUTOARR_PORT:-8088}:8088"

    # Network configuration
    # Option 1: Use bridge network (default, services accessed by IP)
    # Option 2: Join existing *arr stack network (recommended)
    networks:
      - autoarr-network
      # Uncomment below if joining existing network:
      # - media-stack

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8088/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    # Resource limits (adjust based on your NAS specs)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

networks:
  autoarr-network:
    driver: bridge
  # Uncomment if connecting to existing network:
  # media-stack:
  #   external: true
  #   name: media-stack

# Note: On Synology, you can also add this container to an existing
# network through the Container Manager UI:
# 1. Go to Container Manager > Network
# 2. Select your existing network (e.g., where SABnzbd/Sonarr run)
# 3. Click "Join" and select the autoarr container
