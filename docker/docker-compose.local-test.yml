# =============================================================================
# AutoArr Local Development Environment
# =============================================================================
# This docker-compose file runs AutoArr for local development.
# Source code is mounted from Windows for live backend reloading.
#
# Access Point:
#   - http://localhost:8001 - Full application (UI + API)
#
# Backend Changes:
#   - Python code changes are detected automatically (no restart needed)
#
# Frontend Changes:
#   - Run `pnpm build` in /app/autoarr/ui after UI changes
#   - Then refresh your browser
#
# Usage:
#   docker-compose -f docker/docker-compose.local-test.yml up -d
#   docker-compose -f docker/docker-compose.local-test.yml logs -f
#   docker-compose -f docker/docker-compose.local-test.yml down
# =============================================================================

name: autoarr_app

services:
  autoarr:
    image: autoarr:dev
    build:
      context: ..
      dockerfile: docker/Dockerfile.dev
    container_name: autoarr-local
    restart: unless-stopped

    ports:
      - "8001:8088"

    environment:
      APP_ENV: development
      LOG_LEVEL: DEBUG
      PORT: 8088
      PYTHONPATH: /app
      DATABASE_URL: sqlite:////data/autoarr.db
      REDIS_URL: memory://

    volumes:
      # Mount source code from Windows
      - c:/Git/autoarr/autoarr:/app/autoarr:cached
      - c:/Git/autoarr/scripts:/app/scripts:cached

      # Persistent data
      - autoarr-data:/data
      - autoarr-logs:/app/logs

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8088/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  autoarr-data:
  autoarr-logs:
