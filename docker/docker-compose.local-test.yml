# =============================================================================
# AutoArr Local Testing Environment
# =============================================================================
# This docker-compose file runs AutoArr for local testing with fast feedback.
# Uses host network mode to connect to existing Sonarr/Radarr/SABnzbd on localhost.
#
# Prerequisites:
#   1. Copy .env.example to .env in repo root and configure your service URLs/API keys
#   2. Ensure your media services are accessible on localhost
#
# Usage:
#   docker-compose -f docker/docker-compose.local-test.yml up -d
#   docker-compose -f docker/docker-compose.local-test.yml logs -f
#   docker-compose -f docker/docker-compose.local-test.yml down
#
# Features:
#   - Host network for localhost service access
#   - Code baked into image at build time (no volume mounts needed)
#   - Fast iteration for testing changes
# =============================================================================

name: autoarr_app

services:
  autoarr-local:
    image: autoarr-local:latest
    build:
      context: ..
      dockerfile: docker/Dockerfile.local-test
    container_name: autoarr-local-test
    restart: unless-stopped

    # Use host network to access services on localhost
    network_mode: host

    environment:
      # Application Settings
      APP_ENV: development
      LOG_LEVEL: DEBUG
      PORT: 8088

      # Database (SQLite for local testing)
      DATABASE_URL: sqlite:////data/autoarr.db

      # Redis (in-memory for local testing)
      REDIS_URL: memory://

    volumes:
      # Persistent data only (no source mounts - code is baked into image)
      - autoarr-data:/data
      - autoarr-logs:/app/logs

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8088/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  autoarr-data:
  autoarr-logs:
